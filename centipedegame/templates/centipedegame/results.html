{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<title>Centipede Game | Results</title>
	<link rel="stylesheet" type="text/css" href="{% static 'css/mainstyle.css' %}"/>
	<link rel="stylesheet" type="text/css" href="{% static 'css/centistyle.css' %}"/>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-cartesian.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-heatmap.min.js"></script>
</head>

<body>

{% if game.results_visible or admin_user %}

    <h1>Results {{ game.game_setting.long_name }} - Session {{ session.long_name }}</h1>

    <div class="navigation">
        <span class="navigation-button">
            <a href="{% url 'centipede_game:index' session.slug_name game.url_tag %}">&#8610;&nbsp;To game home</a>
        </span>
        <br>
        <span class="navigation-button">
            <a href="{% url 'core:session_home' session.slug_name %}">&#8610;&nbsp;To session home</a>
        </span>
    </div>

    <div class="adminDiv">

        {% if admin_user %}
            <div class="warning-box">
                <p>Here are so admin shortcuts if you want to use them.</p>

                {% if game.playable %}
                    <p>Players can currently submit their answers.</p>
                    <form method="post" action="{% url 'centipede_game:results' session.slug_name game.url_tag %}">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="game_playable"/>
                        <p class="center-align">
                            <input class="green-button" type="submit" value="Close the Game"/>
                        </p>
                    </form>
                {% else %}
                    <p>The game is closed, player can no longer submit their answers.</p>
                    <form method="post" action="{% url 'centipede_game:results' session.slug_name game.url_tag %}">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="game_playable"/>
                        <p class="center-align">
                            <input class="green-button" type="submit" value="Open the Game"/>
                        </p>
                    </form>
                {% endif %}

                {% if game.results_visible %}
                    <p>The results are visible by all players.</p>
                    <form method="post" action="{% url 'centipede_game:results' session.slug_name game.url_tag %}">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="results_visible"/>
                        <p class="center-align">
                            <input class="green-button" type="submit" value="Hide the Results"/>
                        </p>
                    </form>
                {% else %}
                    <p>Players cannot currently see the results.</p>
                    <form method="post" action="{% url 'centipede_game:results' session.slug_name game.url_tag %}">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="results_visible"/>
                        <p class="center-align">
                            <input class="green-button" type="submit" value="Show the Results"/>
                        </p>
                    </form>
                {% endif %}
                <p>
                    To manually run the management commands, click the following button. This is normally unnecessary,
                    unless you changed the entries of the database directly, or performed some other manual actions.
                </p>
                <form method="post" action="{% url 'centipede_game:results' session.slug_name game.url_tag %}">
                    {% csrf_token %}
                        <input type="hidden" name="form_type" value="run_management"/>
                    <p class="center-align">
                        <input class="green-button" type="submit" value="Run Management Commands"/>
                    </p>
                </form>
            </div>
        {% endif %}
    </div>

    <div id="histogram_strat" class="graph_wrap"></div>
    <script>
        var histo_strat_chart = anychart.column();
        histo_strat_chart.title('Distribution of strategies submitted as player 1 and 2');
        histo_strat_chart.xAxis().title('Strategy');
        histo_strat_chart.yAxis().title('');
        var histo_strat1_data = [
                {{ game.result_centi.histo_strat1_js_data|safe }}
            ];
        var histo_strat1_serie = histo_strat_chart.column(histo_strat1_data);
        histo_strat1_serie.name('Number of answers for player 1')
        histo_strat1_serie.stroke({color:'#ffffff'})
        histo_strat1_serie.fill('#A30000')
        var histo_strat2_data = [
                {{ game.result_centi.histo_strat1_js_data|safe }}
            ];
        var histo_strat2_serie = histo_strat_chart.column(histo_strat2_data);
        histo_strat2_serie.name('Number of answers for player 2')
        histo_strat2_serie.stroke({color:'#ffffff'})
        histo_strat2_serie.fill('#008C8C')
        histo_strat_chart.container('histogram_strat');
        histo_strat_chart.draw();
    </script>

    <div id="score_heatmap" class="graph_wrap"></div>
    <script>
        var score_heatmap_data = [
                {{ game.result_centi.scores_heatmap_js_data|safe }}
            ];
        var score_heatmap_chart = anychart.heatMap(score_heatmap_data);
        score_heatmap_chart.container('score_heatmap');
        score_heatmap_chart.draw();
    </script>

    <div class="navigation">
        <span class="navigation-button">
            <a href="{% url 'centipede_game:index' session.slug_name game.url_tag %}">&#8610;&nbsp;To game home</a>
        </span>
        <br>
        <span class="navigation-button">
            <a href="{% url 'core:session_home' session.slug_name %}">&#8610;&nbsp;To session home</a>
        </span>
    </div>
{% else %}
    <p>
        The results for this game are not visible.
        Get back to the <a href="{% url "centipede_game:index" session.slug_name game.url_tag %}">home page</a> of the
        game.
    </p>
{% endif %}
</body>
</html>