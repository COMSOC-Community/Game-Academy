{% extends 'core/base.html' %}{% load static %}

{% block title %}Session {{ session.name }}{% endblock %}

{% block header %}
    <h1>Session {{ session.long_name|title }}</h1>
{% endblock %}

{% block content %}
    {% if session.visible or admin_user %}

        {% if not session.visible %}
            <section class="warning-section">
                <p>This session is not visible, you are only seeing this page because you are an admin!</p>
            </section>
        {% endif %}

        <section>
            <p>
                Welcome on the index page for session {{ session.long_name }}. This is the entry door to the session.
            </p>

            {% if admin_user or player_user %}
                <p>
                    You are currently logged in as <em>{% if player_user %}{{ player_user.name }}{% else %}{% if admin_user %}{{ request.user.username }}{% endif %}{% endif %}</em>.
                    You can thus directly go to <a href="{% url 'core:session_home' session.slug_name %}">home page of the session</a>.
                    You can also log out if you want.
                </p>

                <p class="center-align">
                    <span class="button"><a href="{% url 'core:logout' %}?next={% url 'core:index_session' session.slug_name %}">Logout</a></span>
                </p>
            {% endif %}
        </section>

        {% if session.can_register %}
            <section>
                {% if player_created %}
                    <div class="form-success-message">
                        <p>The player {{ new_player.name }} has been created. You can now use the form below to log in.</p>
                    </div>
                {% else %}

                    {% if session.need_registration %}
                        <p>
                            This session requires users to be logged in to play. You can use the form below to register as a player.
                            You will then be able to log in.
                        </p>
                    {% else %}
                        <p>
                            The registration is open for this session. Use the form below if you want to register. You can also
                            choose to continue as a guest.
                        </p>
                    {% endif %}

                    <p class="form-error">{{ player_creation_error }}</p>

                    <form action="{% url 'core:index_session' session.slug_name %}" method="post">
                        {% include "include/form_table_template.html" with form=registration_form form_type='registration_form' submit_button_label='Register as a Player' %}
                    </form>
                {% endif %}
            </section>
        {% endif %}

        <section>
            {% if session.need_registration %}
                <p>
                    To access this session, you need to be logged in. You can do so by using the form below.
                    {% if session.can_register %}
                        If you have not yet registered as a player, please do so above, and then log in.
                    {% else %}
                        The registration form is now closed, please contact the session admin if you still need to register.
                    {% endif %}
                </p>
            {% else %}
                <p>
                    You can choose to log in to continue, or to register as a guest. Logging in will allow you to save your
                    action in your player profile, something you cannot do as a guest.
                </p>
            {% endif %}

            {% if not session.need_registration %}
                <div class="side-by-side-wrapper">
                <div class="side-by-side-box">
            {% else %}
                <div>
            {% endif %}
                <p class="form-error">{{ general_login_error }}</p>

                <form action="{% url 'core:index_session' session.slug_name %}" method="post">
                    {% include "include/form_table_template.html" with form=login_form form_type='login_form' submit_button_label='Log in' %}
                </form>
            </div>

                {% if not session.need_registration %}
                    <div class="side-by-side-box">
                        <p>{{ guest_creation_error }}</p>

                        <form action="{% url 'core:index_session' session.slug_name %}" method="post">
                        {% include "include/form_table_template.html" with form=guest_form form_type='guest_form' submit_button_label='Continue as guest' %}
                        </form>
                    </div>
                {% endif %}
            {% if not session.need_registration %}
                </div>
            {% endif %}
        </section>

        {% if admin_user %}
            <section>
                <div class="warning-section">
                    <p>
                        Since you are logged in as an admin, you can also access the
                        <a href="{% url 'core:session_admin' session.slug_name %}">admin page</a>.
                    </p>
                </div>
            </section>
        {% endif %}
    {% else %}
        <p>
            This session exists but is not visible. Contact the session admin if you believe that this is a problem.
        </p>
    {% endif %}
{% endblock %}
