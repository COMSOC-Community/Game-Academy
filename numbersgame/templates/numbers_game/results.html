{% extends 'core/base_game.html' %}
{% load core_extras %}

{% load static %}

{% block extra_head %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/ngstyle.css' %}"/>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-cartesian.min.js"></script>
{% endblock %}

{% block game_content %}
    <section>
        <h2 class="collapsible-div">Sample answers</h2>

        <div class="collapse_content" style="display: none;">
            <table class="lined-table center-margin">
                <tr>
                    <th>Answer</th>
                    <th>Justification</th>
                </tr>
                {% for answer in shuffled_answers %}
                    <tr class="show-one-by-one" style="display: none">
                        <td>{{ answer.answer }}</td>
                        <td>{{ answer.motivation }}</td>
                    </tr>
                {% endfor %}
            </table>

            <p class="center-align">
                <button type="button" onclick="appearOneByOne();" class="green-button">
                    Display another answer
                </button>
            </p>
        </div>
    </section>

    <section>
        <h2 class="collapsible-div">Distribution of the answers</h2>

        <div class="collapse_content" style="display: none;">
            <div id="histogram" class="graph_wrap">
            </div>
            <script>
                var histoData = [
                        {{ game.result_ng.histo_js_data|safe }}
                    ];
                var histoChart = anychart.column();
                histoChart.title('Distribution of the answers received');
                histoChart.yAxis().title('Answer');
                histoChart.xAxis().title('Answer range');
                var histoSerie = histoChart.column(histoData);
                histoSerie.name('Number of answers')
                histoSerie.stroke({color:'#ffffff'})
                histoSerie.fill('#FF8000')
                histoChart.container('histogram');
                histoChart.draw();
            </script>
        </div>
    </section>

    <section>
        <h2 class="collapsible-div">Details</h2>

        <div class="collapse_content" style="display: none;">

            <table class="lined-table center-margin">
                <tr>
                    <th>Average answer</th>
                    <td>{{ game.result_ng.average|floatformat:5 }}</td>
                </tr>
                <tr>
                    <th>{{ game.numbers_setting.factor_display }} of the average</th>
                    <td>{{ game.result_ng.corrected_average|floatformat:5 }}</td>
                </tr>
                <tr>
                    <th>Winning answer{{ winning_answers|length|pluralize:',s' }}</th>
                    <td>{{ winning_answers_formatted|float_formatter:5 }}</td>
                </tr>
                {% if admin_user %}
                    <tr>
                        <th>Winner{{ winners|length|pluralize:',s' }}</th>
                        <td>{{ winners_formatted }}</td>
                    </tr>
                {% endif %}
            </table>
        </div>
    </section>

    <section>
        <h2 class="collapsible-div">All answers anonymised</h2>

        <div class="collapse_content" style="display: none;">
            <table class="lined-table center-margin">
                <tr>
                    <th>Answer</th>
                    <th>Gap</th>
                    <th>Justification</th>
                </tr>
                {% for answer in answers %}
                    <tr>
                        <td {% if answer.winner %}class="winning"{% endif %}>{{ answer.answer }}</td>
                        <td {% if answer.winner %}class="winning"{% endif %}>{{ answer.gap|float_formatter:5 }}</td>
                        <td {% if answer.winner %}class="winning"{% endif %}>{{ answer.motivation }}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </section>

    {% if admin_user %}
        <section class="warning-section">
            <h2 class="collapsible-div">All answers with names</h2>

            <div class="collapse_content" style="display: none;">
                <table class="lined-table center-margin">
                    <tr>
                        <th>Player</th>
                        <th>Answer</th>
                        <th>Gap</th>
                        <th>Justification</th>
                    </tr>
                    {% for answer in answers %}
                        <tr>
                            <td {% if answer.winner %}class="winning"{% endif %}>{{ answer.player.name }}</td>
                            <td {% if answer.winner %}class="winning"{% endif %}>{{ answer.answer }}</td>
                            <td {% if answer.winner %}class="winning"{% endif %}>{{ answer.gap|float_formatter:5 }}</td>
                            <td {% if answer.winner %}class="winning"{% endif %}>{{ answer.motivation }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </section>
    {% endif %}
{% endblock %}


{% block extra_scripts %}
    <script>
        var coll = document.getElementsByClassName("collapsible-div");
        var i;
        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                var content = this.nextElementSibling;
                if (content.style.display === "none"){
                    content.style.display = "block";
                } else {
                    content.style.display = "none";
                }
            });
        }
    </script>

    <script>
        var count = 0;
        function appearOneByOne() {
            items = document.getElementsByClassName("show-one-by-one");
            if(count < items.length) {
                items[count++].style.display = "table-row";
            }
        }
    </script>
{% endblock %}

{% block game_navigation %}
    <div class="side-by-side-centered-wrapper">
        {% include 'include/game_navigation_home.html' %}
    </div>
{% endblock %}